!function a(o,u,c){function l(e,t){if(!u[e]){if(!o[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(s)return s(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=u[e]={exports:{}};o[e][0].call(i.exports,function(t){return l(o[e][1][t]||t)},i,i.exports,a,o,u,c)}return u[e].exports}for(var s="function"==typeof require&&require,t=0;t<c.length;t++)l(c[t]);return l}({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.update_script=r.add_script=r.delete_script=void 0;var o=t("./types"),u=n(t("../reducers/output")),c=n(t("../reducers/menu")),l=n(t("../reducers/data"));function n(t){return t&&t.__esModule?t:{default:t}}r.delete_script=function(t,e){var r=o.DELETE_SCRIPT,n=e.id,i=e.inputs,a=e.menuItem;(0,l.default)({type:r,scripts:t,id:n}),(0,u.default)({type:r,inputs:i}),(0,c.default)({type:r,menuItem:a})};r.add_script=function(t,e,r){var n=o.ADD_SCRIPT,i=(0,l.default)({type:n,scripts:t,data:e});(0,c.default)({type:n,data:i,dest:r.menu}),(0,u.default)({type:n,data:i,dest:r.output})};r.update_script=function(t,e,r){var n=o.UPDATE_SCRIPT,i=(0,l.default)({type:n,script:t,data:e});(0,u.default)({type:n,value:i,dest:r.input}),r.menuItem&&(0,c.default)({type:n,attr:e.attr,value:i,dest:r.menuItem})}},{"../reducers/data":8,"../reducers/menu":9,"../reducers/output":10,"./types":2}],2:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UPDATE_SCRIPT=r.ADD_SCRIPT=r.DELETE_SCRIPT=void 0;r.DELETE_SCRIPT="DELETE_SCRIPT";r.ADD_SCRIPT="ADD_SCRIPT";r.UPDATE_SCRIPT="UPDATE_SCRIPT"},{}],3:[function(t,e,r){"use strict";var n,i=(n=t("./modules/dataset"))&&n.__esModule?n:{default:n},g=t("./modules/utilities"),s=t("./actions/scriptActions"),u=t("./modules/transform"),a=t("./modules/editor");function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=new i.default,S=o.scripts,b=o.options;console.log(b);var c=(0,a.getEditorSettings)(b),_=wp.codeEditor.initialize(document.getElementById("savantEditor"),c);({elements:{_svt:document.getElementById("savant_meta"),menu:document.querySelector(".savant-tab ul"),output:document.querySelector(".savant-data"),settings:document.querySelectorAll(".savant-settings .settings-field"),icons:document.querySelectorAll(".controls i.icon")},init:function(){(0,g.isEmpty)(S)?this.newSession(!0):this.setActiveScript((0,g.getFirstScript)(S)),this.events()},events:function(){var e=this,t=this.elements,r=t._svt,n=t.menu,i=t.settings,a=t.icons;n.addEventListener("click",this.selectScript.bind(this)),_.codemirror.on("change",this.codeUpdate.bind(this)),i.forEach(function(t){return t.addEventListener("input",e.attrUpdate.bind(e))}),r.querySelector("i.trash").addEventListener("click",this.deleteScript.bind(this)),r.querySelector('button.btn[type="submit"]').addEventListener("click",this.newScript.bind(this)),a.forEach(function(t){return t.addEventListener("click",e.toggleMenu.bind(e))}),r.querySelectorAll(".btn.radio").forEach(function(t){return t.addEventListener("click",e.toggleButtons)}),r.querySelector(".file .upload").addEventListener("click",this.uploadFile.bind(this))},selectScript:function(t){if(t.target.classList.contains("button-language")){var e=t.target.getAttribute("data-id");(0,g.uniqueID)(S);this.setActiveScript(e)}},setActiveScript:function(t){this.activeScript={id:t,codeOutput:this.elements.output.querySelector('input[data-id="'.concat(t,'"][data-attribute="code"]'))},_.codemirror.setValue(S[t].code),_.codemirror.setOption("mode",b.mode[S[t].language]),document.querySelector(".savant-window").dataset.type=S[t].type;var e=!0,r=!1,n=void 0;try{for(var i,a=this.elements.menu.children[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.classList[o.dataset.id==t?"add":"remove"]("active")}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}for(var u=S[t],c=u.label,l=u.type,s=u.language,d=u.file,p=Object.entries({label:c,type:l,language:s}),f=0;f<p.length;f++){var v=h(p[f],2),m=v[0],y=v[1];document.querySelector('.settings-field[data-attribute="'.concat(m,'"]')).value=y}document.querySelector(".savant-window").dataset.type=l,document.querySelector(".file div span").textContent=(0,g.getFileName)(d)},newSession:function(t){document.querySelector(".savant-config").classList[t?"add":"remove"]("new","expand"),document.querySelector(".savant.side-bar").classList[t?"add":"remove"]("new","expand")},deleteScript:function(){var t=this.activeScript.id,e=document.querySelector('.savant-tab [data-id="'.concat(t,'"]'));(0,s.delete_script)(S,{id:t,inputs:document.querySelectorAll('.savant-data input[data-id="'.concat(t,'"]')),menuItem:e}),(0,g.isEmpty)(S)?(this.newSession(!0),_.codemirror.setValue("")):this.setActiveScript((0,g.getFirstScript)(S))},attrUpdate:function(t){var e=t.target,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.activeScript.id,i=this.elements,a=i.output,o=i.menu,u=r.attr||e.dataset.attribute,c=r.value||e.value,l={input:a.querySelector('[data-id="'.concat(n,'"][data-attribute="').concat(u,'"]')),menuItem:o.querySelector('[data-id="'.concat(n,'"]'))};(0,s.update_script)(S[n],{attr:u,value:c},l),"language"===u&&_.setOption("mode",b.mode[S[n].language]),"type"===u&&(document.querySelector(".savant-window").dataset.type=c),"file"===u&&(document.querySelector(".file div span").textContent=(0,g.getFileName)(c))},codeUpdate:function(){if(!(0,g.isEmpty)(S)){var t=this.activeScript,e=t.id,r=t.codeOutput,n=_.codemirror.getValue();if((0,s.update_script)(S[e],{attr:"code",value:n},{input:r}),"javascript"===S[e].language&&b.compiler){var i=this.elements.output,a=(0,u.compileCode)(n,["es2015","stage-0"]),o=i.querySelector('input[name="savant_field['.concat(e,'][compiled]"]'));(0,u.updateCompiledCode)(S[e],a,o)}}},newScript:function(t){t.preventDefault();var e=document.querySelector("div.savant-config"),r=e.querySelector(".language input:checked").value,n=e.querySelector(".label input").value||r.toUpperCase(),i=e.querySelector(".type input:checked").value,a=(0,g.uniqueID)(S),o={id:a,language:r,type:i,label:n,code:b.boilerplate[r],file:""};(0,s.add_script)(S,o,this.elements),this.toggleMenu(this.elements._svt.querySelector("i.icon.add-new")),this.newSession(!1),this.setActiveScript(S[a].id)},toggleMenu:function(t){var e=t.target||t,r=e.getAttribute("menu-target");this.elements._svt.querySelector(".".concat(r)).classList.toggle("expand"),e.classList.toggle("open")},toggleButtons:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this.parentNode.children[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var a=n.value;a.classList[this==a?"add":"remove"]("active"),a.children[0].checked=this==a}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}},uploadFile:function(t){var e=this;t.preventDefault();var r,n=(0,g.uploader)();n.on("select",function(){r=n.state().get("selection").first().toJSON(),e.attrUpdate(t,{attr:"file",value:r.url})}),n.open()}}).init()},{"./actions/scriptActions":1,"./modules/dataset":4,"./modules/editor":5,"./modules/transform":6,"./modules/utilities":7}],4:[function(t,e,r){"use strict";function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scripts=this.getInitialScripts(),this.options=this.getOptions()}var e,r,n;return e=t,(r=[{key:"getInitialScripts",value:function(){var t={},e=!0,r=!1,n=void 0;try{for(var i,a=document.querySelectorAll(".savant-data input")[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value,u=o.getAttribute("data-id"),c=o.getAttribute("data-attribute");t[u]||(t[u]={}),t[u][c]=o.value}}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}return t}},{key:"getOptions",value:function(){return Array.from(document.querySelectorAll(".savant-options input")).reduce(function(t,e){var r=e.dataset.attribute,n=e.dataset.language||!1;return t[r]||(t[r]={}),n?t[r][n]=e.value:t[r]=e.value,t},{})}}])&&i(e.prototype,r),n&&i(e,n),t}();r.default=n},{}],5:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getEditorSettings=void 0;r.getEditorSettings=function(t){var e=t.theme,r=t.mode.javascript;console.log(wp.codeEditor);var n=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{};return console.log("initialise"),n.codemirror=_.extend({},n.codemirror,{indentUnit:2,tabSize:2,theme:e,mode:r}),n}},{}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.updateCompiledCode=r.compileCode=void 0;var n=t("../actions/scriptActions");console.log(Babel);r.compileCode=function(t,e){return Babel?Babel.transform(t,{presets:e}).code:null};r.updateCompiledCode=function(t,e,r){return(0,n.update_script)(t,{attr:"compiled",value:e},{input:r})}},{"../actions/scriptActions":1}],7:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.uploader=r.getFileName=r.getFirstScript=r.uniqueID=r.isEmpty=void 0;r.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};r.uniqueID=function t(e){for(var r=Math.floor(9999999*Math.random()+1),n=!0,i=Object.keys(e),a=0;a<i.length;a++)r==i[a]&&(n=!1);if(n)return r;t(e)};r.getFirstScript=function(t){return Object.keys(t)[0]};r.getFileName=function(t){return t.replace(/(.*)wp-content/g,"....")};r.uploader=function(){return wp.media.frames.file_frame=wp.media({title:"Choose a File",button:{text:"Choose File"},multiple:!1})}},{}],8:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=function(t){switch(t.type){case"ADD_SCRIPT":var e=t.data,r=t.scripts;return r[e.id]=e,r[e.id];case"UPDATE_SCRIPT":var n=t.script,i=t.data,a=i.attr,o=i.value;return n[a]=o,n[a];case"DELETE_SCRIPT":var u=t.id;delete t.scripts[u];break;default:return}}},{}],9:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=function(t){switch(t.type){case"ADD_SCRIPT":var e=t.data,r=e.id,n=e.language,i=e.label,a=document.createElement("li");a.dataset.attribute=n,a.dataset.id=r,a.classList.add("button-language"),a.textContent=i,t.dest.appendChild(a);break;case"UPDATE_SCRIPT":var o=t.attr,u=t.value,c=t.dest;"label"===o?c.textContent=u:"language"===o&&(c.dataset.attribute=u);break;case"DELETE_SCRIPT":t.menuItem.remove();break;default:return}}},{}],10:[function(t,e,r){"use strict";function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=function(t){switch(t.type){case"DELETE_SCRIPT":var e=!0,r=!1,n=void 0;try{for(var i,a=t.inputs[Symbol.iterator]();!(e=(i=a.next()).done);e=!0)i.value.remove()}catch(t){r=!0,n=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw n}}break;case"ADD_SCRIPT":for(var o=t.data.id,u=Object.entries(t.data),c=0;c<u.length;c++){var l=m(u[c],2),s=l[0],d=l[1],p=document.createElement("input");p.dataset.attribute=s,p.dataset.id=o,p.name="savant_field[".concat(o,"][").concat(s,"]"),p.type="hidden",p.value=d,t.dest.appendChild(p)}break;case"UPDATE_SCRIPT":var f=t.dest,v=t.value;f.value=v;break;default:return}}},{}]},{},[3]);
//# sourceMappingURL=bundle.js.map
